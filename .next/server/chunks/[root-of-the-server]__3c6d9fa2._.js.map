{"version":3,"sources":["../../../src/lib/services/user-service.ts"],"sourcesContent":["import { db } from '../../db';\nimport { users, type User, type NewUser } from '../../db/schema';\nimport { eq } from 'drizzle-orm';\n\nexport class UserService {\n    static async getOrCreateUser(walletAddress: string): Promise<User> {\n        const existingUser = await db.select().from(users).where(eq(users.id, walletAddress)).get();\n\n        if (existingUser) {\n            return existingUser;\n        }\n\n        const newUser: NewUser = {\n            id: walletAddress,\n            username: `User_${walletAddress.slice(0, 6)}`,\n        };\n\n        const result = await db.insert(users).values(newUser).returning().get();\n        return result;\n    }\n\n    static async updateUserStats(walletAddress: string, stats: Partial<Pick<User, 'wins' | 'losses' | 'totalEarnings'>>) {\n        const existingUser = await this.getOrCreateUser(walletAddress);\n\n        await db.update(users)\n            .set({\n                wins: (existingUser.wins || 0) + (stats.wins || 0),\n                losses: (existingUser.losses || 0) + (stats.losses || 0),\n                totalEarnings: (Number(existingUser.totalEarnings) || 0) + (stats.totalEarnings || 0),\n                updatedAt: new Date(),\n            })\n            .where(eq(users.id, walletAddress))\n            .run();\n    }\n\n    static async getUserProfile(walletAddress: string): Promise<User | undefined> {\n        return await db.select().from(users).where(eq(users.id, walletAddress)).get();\n    }\n}\n"],"names":[],"mappings":"yjCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,wCAEO,OAAM,EACT,aAAa,gBAAgB,CAAqB,CAAiB,CAC/D,IAAM,EAAe,MAAM,EAAA,EAAE,CAAC,MAAM,GAAG,IAAI,CAAC,EAAA,KAAK,EAAE,KAAK,CAAC,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,KAAK,CAAC,EAAE,CAAE,IAAgB,GAAG,GAEzF,GAAI,EACA,OAAO,EAGX,GAJkB,CAIZ,EAAmB,CACrB,GAAI,EACJ,SAAU,CAAC,KAAK,EAAE,EAAc,KAAK,CAAC,EAAG,GAAA,CAAI,AACjD,EAGA,OADe,AACR,MADc,EAAA,EAAE,CAAC,MAAM,CAAC,EAAA,KAAK,EAAE,MAAM,CAAC,GAAS,SAAS,GAAG,GAAG,EAEzE,CAEA,aAAa,gBAAgB,CAAqB,CAAE,CAA+D,CAAE,CACjH,IAAM,EAAe,MAAM,IAAI,CAAC,eAAe,CAAC,EAEhD,OAAM,EAAA,EAAE,CAAC,MAAM,CAAC,EAAA,KAAK,EAChB,GAAG,CAAC,CACD,KAAM,CAAC,EAAa,IAAI,GAAI,CAAC,EAAK,EAAD,AAAO,IAAI,GAAI,CAAC,CACjD,OAAQ,CAAC,EAAa,MAAM,EAAI,CAAC,GAAK,CAAD,CAAO,MAAM,GAAI,CAAC,CACvD,cAAe,CAAC,OAAO,EAAa,aAAa,IAAK,CAAC,EAAK,EAAD,AAAO,aAAa,EAAI,CAAC,EACpF,UAAW,IAAI,IACnB,GACC,KAAK,CAAC,CAAA,EAAA,EAAA,EAAE,AAAF,EAAG,EAAA,KAAK,CAAC,EAAE,CAAE,IACnB,GAAG,EACZ,CAEA,aAAa,eAAe,CAAqB,CAA6B,CAC1E,OAAO,MAAM,EAAA,EAAE,CAAC,MAAM,GAAG,IAAI,CAAC,EAAA,KAAK,EAAE,KAAK,CAAC,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,KAAK,CAAC,EAAE,CAAE,IAAgB,GAAG,EAC/E,CACJ"}